<!DOCTYPE html><p>Hi ðŸ‘‹</p>
<p>In this post I will explain how can you send data from <code>&#x3C;iframe></code> to its parent window without any cors restriction and sending complex objects.</p>
<p>Imagine that you have a website that has an <code>&#x3C;iframe></code> that loads a third party website, and you need to send data from the <code>&#x3C;iframe></code> to the parent window.</p>
<h2 id="lets-start-with-child-iframe-code">Letâ€™s start with child <code>&#x3C;iframe></code> code</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E1E4E8">// child.html</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onclick</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"</span><span style="color:#B392F0">sendDataToParent</span><span style="color:#9ECBFF">()"</span><span style="color:#E1E4E8">>Send data to parent&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">script</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#F97583">  function</span><span style="color:#B392F0"> sendDataToParent</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> message</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      event: </span><span style="color:#9ECBFF">"your_event_id"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      data: {</span></span>
<span class="line"><span style="color:#E1E4E8">        name: </span><span style="color:#9ECBFF">"DamiÃ¡n"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        lastName: </span><span style="color:#9ECBFF">"Pumar"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        age: </span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      },</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    window.parent.</span><span style="color:#B392F0">postMessage</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">(message), </span><span style="color:#9ECBFF">"*"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">script</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>With postMessage we can send data from the <code>&#x3C;iframe></code> to the parent window, but we have some restrictions:</p>
<ul>
<li>We can only send strings.
<ul>
<li>But we can solve this problem using the <code>JSON.stringify</code> and <code>JSON.parse</code> methods.</li>
</ul>
</li>
<li>We can only send data to the parent window.
<ul>
<li>But we can solve this problem using the <code>window.parent</code> property.</li>
</ul>
</li>
</ul>
<p>The postMessage method receives two parameters:</p>
<ul>
<li>The first parameter is the data that we want to send to the parent window.</li>
<li>The second parameter is the origin of the parent window, this parameter is optional, but it is recommended to use it to avoid security problems.</li>
</ul>
<p>So, we have a button that when we click on it, we send a message to the parent window using the <code>postMessage</code> method.</p>
<h2 id="now-lets-see-the-parent-window-code">Now letâ€™s see the parent window code</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E1E4E8">// parent.html</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">iframe</span><span style="color:#B392F0"> src</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"child.html"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">iframe</span><span style="color:#E1E4E8">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">script</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  window.</span><span style="color:#B392F0">addEventListener</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"message"</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">event</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> data</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">parse</span><span style="color:#E1E4E8">(event.data);</span></span>
<span class="line"><span style="color:#E1E4E8">    console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(data);</span></span>
<span class="line"><span style="color:#6A737D">    // {</span></span>
<span class="line"><span style="color:#6A737D">    //   event: "your_event_id",</span></span>
<span class="line"><span style="color:#6A737D">    //   data:</span></span>
<span class="line"><span style="color:#6A737D">    //     { name: "DamiÃ¡n",</span></span>
<span class="line"><span style="color:#6A737D">    //       lastName: "Pumar",</span></span>
<span class="line"><span style="color:#6A737D">    //       age: 32</span></span>
<span class="line"><span style="color:#6A737D">    //     }</span></span>
<span class="line"><span style="color:#6A737D">    // }</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">script</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>Easy right? ðŸ¤“</p>
<p>Hope you like it, see you in the next post ðŸ‘‹</p>
<p>Bye ðŸ™Œ</p>